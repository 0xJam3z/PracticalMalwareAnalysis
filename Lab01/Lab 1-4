Practical Malware Analysis by Sikorski & Hoing

Lab 1-4

1. Upload the Lab01-04.exe file to https://www.VirusTotal.com and view the reports. Does it match any existing antivirus definitions?

VirusTotal indicates the detection ratio is 63/76.

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Strings showcases a lot of functions and imports. PeID further shows this file is compiled with Microsfot Visual C++ 6.0.

3. When was this program compiled?

PEview shows the program being compiled on 08/30/2019.

4. Do any imports hint at this program's functionality? If so, which imports are they and what do they tell you?

Strings alone give a quick tell that the program is creating a remote thread, loading libs, creating a file and writing, move the file(s),
tamper with tokens, and finally hints at \system32\wupdmgr.exe and winlogon.exe. Let's run dependancy walker to see how this is unfolding. 
Kernel32.dll shows the usage of CreateFileA, CreateREmoteThread, LoadLibraryA, MoveFileA, OpenProcess, Winexec, and WriteFile. Short summary would
agree with previous strings find. Advapi32.dll shows that a token is looked up, adjusted, and opened. This proceeds to a rabbit hole of further calls 
to other local APIs that seem to be briding a connection to an outside source. Likely this malware is being staged. There seem to be a lot of network 
calls and I'll note WS2_32.dll calls on 'WSAStringToAddressW, WSAAddressToStringW, and WSAAddressToStringA." This further drops down into dnsapi.dll. 
This would lead me to believe this malware is tampering with the local DNS entries. Going further the program seems start pulling in obfuscated functions,
e.g. MSVCRT called by IPHLPAPI.dll shows strange functions such as '??2@YAPAXI@Z.' Noticing functions of DHCPCSVC.dll seem to be pulling information about 
the systems dhcp setup. Getting to the tail end shell32.dll is called with ShellExecuteW, SHGetSpecialFolderPathW, SHChangeNotify. We'll sum this up with the next question.

5. What host- or network-based indicators could be used to identify this malware on the infected machine?

This is a full scale remote trojan being staged, downloading another file 'http://www.practicalmalwareanalysis.com/updater.exe' per strings. In summary 
this malware seems to further give itself trusted permissions from windows. It's creating and manipulating windows enviornment along with registry. 
This seems to just be stage 1 of the virus, although given all of it's functions and dll calls it definitely has complete remote control of the machine.

6. The file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?

Strings fully indicates what this resource is doing. GetWindowsDirectoryA, WinExec, GetTempPathA, URLDownloadToFileA, and again a call to the previous URL from question 5. 
This confirms my initial report that the malware is just a first stage process. Strings also show '\winup.exe' and '\system32\wupdmgrd.exe'

type 'clear' to clear the screen
