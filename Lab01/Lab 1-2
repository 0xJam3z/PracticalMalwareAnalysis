Practical Malware Analysis by Sikorski & Hoing

Lab 1-2

1. Upload the Lab01-02.exe file to https://www.VirusTotal.com and view the reports. Does it match any existing antivirus signatures?

VirusTotal indicates a detection ratio of 56/76
2. Are there any indications that either of these files is packed or obfuscated? If so, what are these indications? If the file is packed, unpack it if possible.

Running strings indicated three instances of UPX (UPX0, UPX1, UPX2.) This is a clear indication UPX is used to pack this. PEid has "Nothing found *" for a compiler.
PEview further confirms UPX by showing three instancecs of IMAGE_SECTION_HEADER UPX1, 2, and 3. Using Free UPX 1.7 I was able to decompress the file. PEid confirms 
this by showing the file as being constructed with Microsoft Visual C++ 6.0.

3. Do any imports hint at the program's functionality? If so, which imports are they and what do they tell you?

Starting with what strings reveals on the deobfuscated file, we can note 4 specific windows based dlls. Kernel32, Advapi32, msvcrt.dll, and wininet.dll. 
Function calls in strings reveal the use of 'GetTimeToFileTime, GetModuleFileNameA, CreateWaitableTimerA, ExitProcess, OpenMutexA, SetWaitableTimer, 
WaitForSingleObject, CreateMutexA, CreateThread, CreateServiceA, StartServiceCtrlDispatcherA, OPenSCManagerA, InternetOpenUrlA, InternetOpenA, Malservice & 
MalService.' Just off of this information alone we can identify that the malware is attempting to create a thread and service. OpenSCManager indicates we will
be establishing a connection to a local or remote machine. This coincides with the 'CreateService' and StartServiceCtrlDispatcherA calls. This tells us we are 
dealing with malware that will be tampering with the service control manager-- with all indication of creating a new service. Internet Explorer 8.0 appears to
be the target of this malware, as illustrated by strings along with InternetOpen/InternetOpenUrlA. Our connection will most likely be made to what strings reveals 
as 'http://www.malwareanalysisbook.com.' Stepping through with Dependency Walker further illustrates this process.

4. What host- or network based indicators could be used to identify this malware on infected machines?

Checking for new services specifically with names Malservice, MalService, and potentially HGL345. Any connection made with host 'http://malwareanalysisbook.com' 
will be central to the outside attack vector. One last indication is potentially Internet Explorer 8.0 running differently, perhaps more slowly as it is the 
application that seems to be targeted.

type 'clear' to clear the screen
