Lab 3-2

My full analysis:

PEid shows the file is compiled using Visual Studio C++ 6.0.
Strings
base64 usage calls to connect
transmit over 80
Long list of functions being called from multiple DLLs.

PEView EXPORT Address table contains 'Install, ServiceMain, UninstallService, installA, uninstallA.' From this alone we can assume this file
will be creating a new service. Let's take a look at dependency walker.

Dependency Walker Analysis:
Kernel32.dll -> 'CreatePipe, CreateProcessA, CreateThread, GetCurrentDirectoryA, GetProAddress, GetStartupInfoA, ReadFile, Sleep, LoadLibraryA'
Advapi32.dll -> 'CreateServiceA, DeleteService, RegCreateKeyA, RegOpenKeyExA, RegSetValueExA'
WS2_32.dll -> 'Only legible function is WSASocketA'
wininet.dll -> 'HttpOpenRequestA, HttpSendRequestA, InternetConnectA, InternetOpenA, InternetReadFile'

RegShot:
6 keys added all under 'HKLM\SYSTEM\ControlSet001\Services\IPRIP' & 'HKLM\SYSTEM\CurrentControlSet\Services\IPRIP'

Windows Powershell:
Get-Service shows IPRIP
net start IPRIP

ApateDNS:
Makes a call to practicalmalwareanalysis.com

Process Explorer:

Searching lab03 yields the .dll appended to svchost.exe under PiD 1060. Taking this over to procmon

Procmon:
Running the tampered svchost.exe by using procID filter we see TCP connections being made to our inetsim.
Before those connection calls are made there are several log files and RegQueryValue/OpenKey being made.

inetsim (we could have also used WireShark):

On linux machine using 'sudo cat /var/log/inetsim/service.log'
Pulls a GET request from practicalmalwareanalysis.com looking for /serve.html

From this analysis alone we can assume this is either a zombie, initial staged attack, or backdoor to whatever is being dished out from serve.html
For the purpose of this assignment, we won't go any further.

1. How can you get his malware to install itself?

cmd -> rundll32.exe lab03-02.dll, installA

2. How would you get this malware to run after installation?

net start IPRIP

3. How can you find the process under which this malware is running?

Regshot shows ImagePath for IPRIP is '%SystemRoot%\System32\svchost.exe -k netsvcs'
Process Explorer -> Filter for lab03-02.dll

4. Which filters could you set in order to use procmon to glean information?

Since process explorer gives us the PiD, we can filter for the svchost attached to our lab03-02.dll pid.

5. What are the malware's host-based indicators?

The regshot installation of a new service called IPRIP.

6. Are there any useful network-based signatures for this malware?

The malware sends a GET request to practicalmalwareanalysis.com looking for /serve.html
